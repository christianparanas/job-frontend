<div class="relative z-40 mt-20 pb-20">
  <div class="mb-5">
    <h1 class="font-bold text-xl md:text-3xl text-gray-900">
      Your Career Pathway
    </h1>
    <p class="text-gray-800 text-[12px]">
      Explore your career progression based on your skills. Click a role to view
      details.
    </p>
  </div>

  <hr class="border-gray-200 mb-6" />

  <!-- Loading and Error States -->
  <div *ngIf="!isPathwayLoaded && !error" class="text-center py-10">
    <i class="fas fa-spinner fa-spin text-2xl text-gray-600 mb-2"></i>
    <p class="text-gray-600">Loading career pathway...</p>
  </div>
  <div
    *ngIf="error"
    class="text-center py-10 bg-red-100 text-red-600 rounded-lg p-4"
  >
    <i class="fas fa-exclamation-triangle mr-2"></i> {{ error }}
  </div>

  <!-- Pathway Visualization with PrimeNG OrganizationChart -->
  <div class="pathway-content" *ngIf="isPathwayLoaded">
    <div class="flex flex-col lg:flex-row justify-center items-start gap-8">
      <!-- OrganizationChart Component -->

      <!-- Details and Summary Panel -->
      <div class="details-container w-full lg:w-[600px]">
        <!-- Summary Card -->
        <div
          class="bg-white shadow-md border border-slate-200 rounded-lg p-6 mb-6"
        >
          <h3
            class="text-lg font-semibold text-gray-800 flex items-center mb-4"
          >
            <i class="fas fa-info-circle mr-2 text-blue-500"></i> Career Summary
          </h3>
          <div class="space-y-2 text-gray-600">
            <p>
              <strong>Current Role:</strong>
              {{ currentRoleKey ? pathway[currentRoleKey].role : "N/A" }}
            </p>
            <p>
              <strong>Next Role:</strong>
              {{ nextRoleKey ? pathway[nextRoleKey].role : "N/A" }}
            </p>
            <p>
              <strong>Overall Progress:</strong>
              <span class="text-green-600 font-medium"
                >{{ calculateOverallProgress() | number : "1.0-0" }}%</span
              >
            </p>
            <div class="w-full bg-gray-200 rounded-full h-2.5 mt-2">
              <div
                class="bg-green-600 h-2.5 rounded-full"
                [style.width]="calculateOverallProgress() + '%'"
              ></div>
            </div>
          </div>
        </div>

        <!-- Details Card -->
        <div
          class="bg-white shadow-md border border-slate-200 rounded-lg p-6"
          *ngIf="selectedRole"
        >
          <h4
            class="text-lg font-semibold text-gray-800 flex items-center mb-4"
          >
            <i class="fas fa-user-check mr-2 text-purple-500"></i>
            {{ selectedRole.role }} Details
          </h4>
          <div class="space-y-4 text-gray-600">
            <p><strong>Level:</strong> {{ selectedRole.level }}</p>
            <p><strong>Description:</strong> {{ selectedRole.description }}</p>
            <p>
              <strong>Status:</strong>
              <span
                [ngClass]="{
                  'text-green-600': selectedRole.isEligible,
                  'text-red-600': !selectedRole.isEligible
                }"
              >
                {{ selectedRole.isEligible ? "Eligible" : "Not Eligible" }}
              </span>
            </p>

            <div
              *ngIf="
                !selectedRole.isEligible &&
                selectedRole.missingSkills.length > 0
              "
              class="bg-yellow-100 p-3 rounded-md"
            >
              <h5 class="font-medium text-gray-800 flex items-center mb-2">
                <i class="fas fa-exclamation-circle mr-2 text-yellow-600"></i>
                Skills to Improve:
              </h5>
              <ul class="list-disc list-inside text-sm">
                <li *ngFor="let skill of selectedRole.missingSkills">
                  {{ skill.skill }} (Current: {{ skill.userLevel }} / Required:
                  {{ skill.requiredLevel }})
                </li>
              </ul>
            </div>

            <div>
              <p class="font-medium text-gray-800 flex items-center mb-2">
                <i class="fas fa-chart-line mr-2 text-blue-500"></i> Progress:
              </p>
              <p class="text-sm">
                {{
                  ((selectedRole.requirements.length -
                    selectedRole.missingSkills.length) /
                    selectedRole.requirements.length) *
                    100 | number : "1.0-0"
                }}%
              </p>
              <div class="w-full bg-gray-200 rounded-full h-2.5 mt-1">
                <div
                  class="bg-blue-500 h-2.5 rounded-full"
                  [style.width]="
                    ((selectedRole.requirements.length -
                      selectedRole.missingSkills.length) /
                      selectedRole.requirements.length) *
                      100 +
                    '%'
                  "
                ></div>
              </div>
            </div>

            <!-- All Requirements -->
            <div>
              <h5 class="font-medium text-gray-800 flex items-center mb-2">
                <i class="fas fa-list-ul mr-2 text-green-500"></i> Required
                Skills:
              </h5>
              <ul class="list-disc list-inside text-sm">
                <li
                  *ngFor="let req of selectedRole.requirements"
                  class="hover:bg-gray-100 p-1 rounded"
                >
                  {{ req.skill }} (Required: {{ req.requiredLevel }}, Current:
                  {{ req.userLevel }})
                  <span
                    *ngIf="req.meetsRequirement"
                    class="text-green-500 ml-2"
                  >
                    <i class="fas fa-check"></i>
                  </span>
                  <span *ngIf="!req.meetsRequirement" class="text-red-500 ml-2">
                    <i class="fas fa-times"></i>
                  </span>
                </li>
              </ul>
            </div>

            <!-- Recommendations -->
            <div *ngIf="recommendations.length > 0">
              <h5 class="font-medium text-gray-800 flex items-center mb-2">
                <i class="fas fa-lightbulb mr-2 text-yellow-500"></i>
                Recommendations
              </h5>
              <ul class="list-disc list-inside text-sm">
                <li
                  *ngFor="let rec of recommendations"
                  class="hover:bg-gray-100 p-1 rounded"
                >
                  {{ rec.action }}
                  <a
                    *ngIf="rec.resource"
                    [href]="rec.resource"
                    target="_blank"
                    class="text-blue-500 underline ml-1"
                  >
                    <i class="fas fa-external-link-alt"></i> Learn More
                  </a>
                </li>
              </ul>
            </div>

            <!-- Learning Resources -->
            <div
              *ngIf="
                selectedRole.recommendedResources &&
                selectedRole.recommendedResources.length > 0
              "
            >
              <h5 class="font-medium text-gray-800 flex items-center mb-2">
                <i class="fas fa-book mr-2 text-indigo-500"></i> Learning
                Resources
              </h5>
              <ul class="list-disc list-inside text-sm">
                <li
                  *ngFor="let resource of selectedRole.recommendedResources"
                  class="hover:bg-gray-100 p-1 rounded"
                >
                  <a
                    [href]="resource.url"
                    target="_blank"
                    class="text-indigo-500 underline"
                  >
                    {{ resource.title }}
                    <i class="fas fa-external-link-alt ml-1"></i>
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="chart-container w-full lg:w-2/3">
        <div class="bg-white shadow-md border border-slate-200 rounded-lg p-6">
          <h2
            class="text-xl font-semibold text-gray-800 flex items-center mb-10"
          >
            <i class="fas fa-chart-network mr-2 text-green-500"></i> Career
            Hierarchy
          </h2>
          <p-organizationChart
            [value]="chartData"
            selectionMode="single"
            [(selection)]="selectedNode"
            (onNodeSelect)="onNodeSelect($event)"
            class="custom-org-chart"

            [style]="{ 'max-height': '600px', 'overflow-y': 'auto' }"
          >
            <ng-template let-node pTemplate="default">
              <div
                class="node-content"
                [ngClass]="getNodeClass(node)"
                pTooltip="{{ node.label }} Details"
                tooltipPosition="top"
              >
                <div class="flex items-center justify-center h-full">
                  <i
                    class="fas"
                    [ngClass]="{
                      'fa-user-tie': node.data?.level === 'Associate',
                      'fa-user-graduate':
                        node.data?.level === 'Senior Associate',
                      'fa-user-secret': node.data?.level === 'Professional'
                    }"
                    [class.text-blue-500]="node.data?.key === currentRoleKey"
                    [class.text-yellow-500]="node.data?.key === nextRoleKey"
                  ></i>
                  <span class="ml-2">{{ node.label }}</span>
                </div>
              </div>
            </ng-template>
          </p-organizationChart>
        </div>
      </div>
    </div>
  </div>
</div>
